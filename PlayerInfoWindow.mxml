<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" fontSize="12" horizontalScrollPolicy="off" verticalScrollPolicy="off" backgroundImage="{IMAGE_DIRECTORY}windowBg.jpg"
					paddingLeft="5" paddingBottom="5" paddingRight="5" paddingTop="5" showCloseButton="true" close="_close();" headerHeight="22" borderThicknessLeft="5" borderThicknessRight="5">
	    <mx:Script>
        <![CDATA[
		  import flash.events.Event;
          import mx.controls.*;
		  import mx.effects.Effect;
		  import mx.effects.Move;
          import mx.managers.PopUpManager;

		  [Bindable]
		  public var language:int = 0;
		  [Bindable]
		  private var _name:String;
		  [Bindable]
		  private var _country:String;
		  [Bindable]
		  private var _country_code:String;
		  [Bindable]
		  private var _rating:int;
		  [Bindable]
		  private var _rank:String;
		  [Bindable]
		  private var _title:String;
		  [Bindable]
		  private var _status:String;
		  [Bindable]
		  private var _wins:int;
		  [Bindable]
		  private var _losses:int;
		  [Bindable]
		  private var _percentage:Number;
		  [Bindable]
		  private var _streak:int;
		  [Bindable]
		  private var _streak_best:int;
		  [Bindable]

		  public var pmText:String = "";
		  private const IMAGE_DIRECTORY:String = "http://www.81squareuniverse.com/dojo/images/";
		  
		  public function readUser(user:Object):void {
			  _name = user.name;
			  _country = user.country;
			  _country_code = String(user.country_code + 1000).substring(1);
			  if (String(user.rating).match(/^\*/)) {
				  _rating = user.rating.substr(1);
			  } else {
				_rating = user.rating;
			  }
			  _rank = user.rank;
			  _title = user.titleName;
			  _wins = user.wins;
			  _losses = user.losses;
			  _streak = Math.max(0, user.streak);
			  _streak_best = user.streak_best;
			  if (_wins + _losses == 0) {
				  _percentage = 0;
			  } else {
				  _percentage = _wins / (_wins + _losses) * 100;
			  }
			  if (user.monitor_game != "*") {
				  _status = "Now monitoring " + user.monitor_game.split("+")[0] + " vs " + user.monitor_game.split("+")[1];
			  } else if (user.opponent != "") {
				  _status = "Now playing against " + user.opponent;
			  } else {
				  _status = "";
			  }
			  avatarCanvas.addChild(InfoFetcher.medalCanvas(user));
		  }
		  
		  private function _swfError():void {
//			  flagLoader.source = IMAGE_DIRECTORY + "flags_m/err.swf";
		  }
		  
		public function scrollDown():void{
		  pmTextArea.verticalScrollPosition = pmTextArea.maxVerticalScrollPosition;
		}
		  
		  public function togglePM():void {
			  if (pmCheckBox.selected) {
				pmTextArea.visible = true;
			  } else {
				pmTextArea.visible = false;
			  }
		  }
		  
		  private function _clearHighlight():void {
			  pmTextArea.setStyle('backgroundColor', undefined);
			  pmTextArea.callLater(scrollDown);
		  }

          private function _close():void {
			dispatchEvent(new Event("close_window"));
            PopUpManager.removePopUp(this);
          }

        ]]>
    </mx:Script>
    <mx:Move id="showMove" yFrom="103" yTo="0" duration="200" />
	<mx:Move id="hideMove" yFrom="0" yTo="103" duration="150" />
	<mx:HBox>
		<mx:Canvas id="avatarCanvas" width="128" height="128">
			<mx:Image width="128" height="128"  source="{IMAGE_DIRECTORY}avatars/{_rank}.jpg"/>
		</mx:Canvas>
		<mx:VBox>
			<mx:HBox verticalAlign="middle">
				<mx:VBox>
					<mx:HBox>
						<mx:Label id="nameLabel" text="{_name}" fontSize="15" fontWeight="bold" />
						<mx:Label text="{_title}" fontSize="15" fontWeight="bold" color="#FF0000" paddingLeft="-2" paddingRight="-2" />
					</mx:HBox>
					<mx:Label paddingRight="10" text="{Language.ac.getItemAt(language).country}:  {_country}"/>
				</mx:VBox>
				<mx:SWFLoader id="flagLoader" width="56" height="44" source="{IMAGE_DIRECTORY}flags_m/{_country_code}.swf" ioError="_swfError();" />
			</mx:HBox>
			<mx:VBox width="260" height="73" horizontalScrollPolicy="off">
				<mx:Label text="{Language.ac.getItemAt(language).rate}:  {_rating}  ({_rank})"/>
				<mx:HBox>
					<mx:Label text="{_wins} {Language.ac.getItemAt(language).win_small}"/>
					<mx:Label text="{_losses} {Language.ac.getItemAt(language).loss_small}"/>
					<mx:Label text="({_percentage.toFixed(1)}%)"/>
					<mx:Label text="{Language.ac.getItemAt(language).total}: {_wins + _losses}"/>
				</mx:HBox>
				<mx:HBox>
					<mx:Label text="{Language.ac.getItemAt(language).streak}: {_streak_best}"/>
					<mx:Label text="({Language.ac.getItemAt(language).current}: {_streak})"/>
				</mx:HBox>
			</mx:VBox>
		</mx:VBox>
	</mx:HBox>
	<mx:Spacer height="-115"/>
	<mx:HBox>
		<mx:Spacer width="50"/>
		<mx:TextArea id="pmTextArea" htmlText="{pmText}" wordWrap="true" editable="false" width="339" height="103" backgroundAlpha="0.93" showEffect="{showMove}" hideEffect="{hideMove}" visible="false" cornerRadius="5" />
	</mx:HBox>
	<mx:HBox>
		<mx:Label text="PM:"/>
		<mx:TextInput id="directMessage" keyDown="_clearHighlight();" width="360" height="23" />
	</mx:HBox>
	<mx:HBox width="100%" horizontalAlign="center" verticalAlign="middle" paddingTop="0">
		<mx:HBox id="othersCommands" visible="false" includeInLayout="false">
			<mx:Button id="challenge" click="_close();" label="{Language.ac.getItemAt(language).challenge}" enabled="false" />
			<mx:Button id="invite" label="{Language.ac.getItemAt(language).invite}" enabled="false"/>
			<mx:Button id="ignore" label="{Language.ac.getItemAt(language).ignore}" enabled="false"/>
		</mx:HBox>
		<mx:HBox id="selfCommands" visible="false" includeInLayout="false">
			<mx:ComboBox id="setRateCombo" enabled="false" width="80" fontSize="10" />
			<mx:Button id="setRateButton" label="Set Rate" enabled="false" />
		</mx:HBox>
		<mx:CheckBox id="pmCheckBox" label="" click="togglePM();" paddingRight="-5" toolTip="Open PM window" />
		<mx:Image source="@Embed('images/icon_greet.png')" click="pmCheckBox.selected = !pmCheckBox.selected; togglePM();" toolTip="Open PM window" />
	</mx:HBox>
</mx:TitleWindow>
